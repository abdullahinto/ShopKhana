{% extends 'index.html' %}

{% block title %}
Home - ShopKhana
{% endblock title %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/banner.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/cat.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/flash.css' , v='1.0') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/just4u.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/footer.css') }}">
{% endblock extra_css %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/banner.js') }}"></script>
<script src="{{ url_for('static', filename='js/flash.js') }}"></script>
<script src="{{ url_for('static', filename='js/just4u.js') }}"></script>
<!-- <script src="{{ url_for('static', filename='js/footer.js') }}"></script> -->
<script src="{{ url_for('static', filename='js/cat.js') }}"></script>
{% endblock extra_js %}

{% block body %}

<!-- Product Promotion Section (Banner/Carousel) -->
<section id="product-promotion">
  <div class="carousel-container">
    <div class="carousel">
      {% for ban in banners %}
      <div class="banner">
        <a href="{{ url_for('show_banner_products', banner_id=ban._id) }}">
          <!-- Use Cloudinary URL from ban.image with transformation parameters -->
          <img src="{{ ban.image.replace('/upload/', '/upload/w_auto,q_auto/') }}" alt="{{ ban.bannerName }}">

        </a>
      </div>
      {% endfor %}
    </div>

    <!-- Carousel Navigation Buttons -->
    <button id="prevBtn" class="nav-button">
      <span class="material-icons">chevron_left</span>
    </button>
    <button id="nextBtn" class="nav-button">
      <span class="material-icons">chevron_right</span>
    </button>
  </div>
</section>

<section id="flash-sale">
  <div class="flash-sale-header">
    <h2>Flash Sale</h2>
    <a href="{{ url_for('promotion_products', promo_category='Flash Sale') }}" class="explore-all-btn">Explore All</a>
  </div>


  <div class="flash-sale-products">
    {% for prod in flash_sale_products %}
    <div class="product-card">
      <!-- Product details part -->
      <a href="{{ url_for('product_page', product_id=prod._id) }}" style="text-decoration: none;">
        <div class="product-image">
          <!-- Primary image -->
          <img
            src="{{ (prod.images[0].replace('/upload/', '/upload/w_auto,q_auto/')) if prod.images else '/static/img/placeholder.png' }}"
            alt="Product Image" class="primary-image" />
          <!-- Secondary image -->
          <img
            src="{{ ((prod.images[1] if prod.images|length > 1 else prod.images[0]).replace('/upload/', '/upload/w_auto,q_auto/'))|default('/static/img/placeholder.png') }}"
            alt="Product Image" class="secondary-image" />
        </div>
        <h3 class="product-title">{{ prod.title }}</h3>
        <div class="product-rating">
          <span class="rating-text"><strong style="color: orange;">BRAND: </strong>{{ prod.brandName }}</span>
        </div>
        <div class="product-pricing">
          <span class="discount-price">Rs.{{ prod.discountedPrice }}</span>
          <span class="original-price">Rs.{{ prod.originalPrice }}</span>
          <span class="discount-percent">{{ prod.discountPercent }}%</span>
        </div>
      </a>

      <a href="{{ url_for('product_page', product_id=prod._id) }}" class="main-add-to-cart-btn" style="text-decoration: none;">
        <i class="fa fa-shopping-cart"></i> Add to Cart
    </a>
    </div>
    {% endfor %}
  </div>








  <div class="mobile-btn-wrapper">
    <a href="{{ url_for('promotion_products', promo_category='Flash Sale') }}" class="explore-all-btn">Explore All</a>
  </div>
</section>

<section id="categories-section">
  <div class="flash-sale-header">
    <h2>Categories</h2>
  </div>

  <div class="categories-grid">
    {% for cat in categories %}
    <div class="category-card card-hidden">
      <a href="{{ url_for('category_products', sk_category=cat.name) }}">
        <div class="icon-box">
          <!-- Category image -->
          <img src="{{ cat.images[0] .replace('/upload/', '/upload/w_auto,q_auto/') }}" alt="category image"
            class="category-image" loading="lazy">
        </div>
        <p class="category-name">{{ cat.name }}</p>
      </a>
    </div>
    {% endfor %}
  </div>

  <div class="cat-load-more-container">
    <a href="#" id="cat-load-more-categories" class="cat-load-more-btn">Load More</a>
  </div>
</section>

<div id="loading-overlay" style="display: none;">
  <div class="loader-wrapper">
    <img src="{{ url_for('static', filename='img/mylogo.png') }}" alt="Logo" class="loader-logo">
    <div class="loader"></div>
  </div>
</div>

<section id="just-for-you">
  <div class="just-for-you-header">
    <h2>Just For You</h2>
  </div>

  <div class="just-for-you-products">
    {% for justprod in just_for_you_products %}
    <div class="product-card">
      <a href="{{ url_for('product_page', product_id=justprod._id) }}" style="text-decoration: none;">
        <div class="product-image">
          <img
          src="{{ (justprod.images[0].replace('/upload/', '/upload/w_auto,q_auto/')) if justprod.images else '/static/img/placeholder.png' }}"
          alt="Product Image" 
          class="primary-image"
          loading="lazy">
        <img 
          src="{{ justprod.images[1].replace('/upload/', '/upload/w_auto,q_auto/') 
                 if justprod.images|length > 1 
                 else justprod.images[0].replace('/upload/', '/upload/w_auto,q_auto/') 
                 |default('/static/img/placeholder.png') }}" 
          alt="Product Image" 
          class="secondary-image"
          loading="lazy">
        

        </div>
        <h3 class="product-title">{{ justprod.title }}</h3>
        <div class="product-rating">
          <span class="rating-text"><strong style="color: orange;">Brand: </strong>{{ justprod.brandName }}</span>
        </div>
        <div class="product-pricing">
          <span class="discount-price">Rs.{{ justprod.discountedPrice }}</span>
          <span class="original-price">Rs.{{ justprod.originalPrice }}</span>
          <span class="discount-percent">{{ justprod.discountPercent }}%</span>
        </div>
      </a>
      <!-- "Add to Cart" control as an anchor styled as a button -->
      <a href="{{ url_for('product_page', product_id=justprod._id) }}" class="main-add-to-cart-btn" style="text-decoration: none;">
        <i class="fa fa-shopping-cart"></i> Add to Cart
    </a>
    

    </div>
    {% endfor %}
  </div>

  <div class="load-more-container">
    <button class="load-more-btn">Load More</button>
  </div>
</section>

<div id="loading-overlay" style="display: none;">
  <div class="loader"></div>
</div>

{% endblock body %}